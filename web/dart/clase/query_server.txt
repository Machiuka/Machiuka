import 'dart:async';
import 'dart:convert';
import 'dart:html';
import 'package:http/http.dart' as http;

import 'global.dart';
import 'ubf_document.dart';
import 'ubf_user.dart';

class QueryServer {
  Global allData = Global();

  List<dynamic> jsonBody = [];
  Future queryServer({required bool docuser}) async {
    var completer = Completer();

    Map<String, dynamic> _obj;
    //daca se refera la document
    if (docuser) {
      _obj = {
        "bazaDate": Global.bazaDate,
        "opt": Global.optiune,
        "idx": allData.ubfDocument.idx,
        "dataDoc": allData.ubfDocument.dataDoc,
        "nrDoc": allData.ubfDocument.nrDoc,
        "emitentDoc": allData.ubfDocument.emitentDoc,
        "destinatarDoc": allData.ubfDocument.destinatarDoc,
        "tipDoc": allData.ubfDocument.tipDoc,
        "continutDoc": allData.ubfDocument.continutDoc,
        "dateEmitentDoc": allData.ubfDocument.dateEmitentDoc,
        "dateDestinatarDoc": allData.ubfDocument.dateDestinatarDoc,
      };
    } else {
      //daca se refera la user
      _obj = {
        "bazaDate": Global.bazaDate,
        "opt": Global.optiune,
        "idx": allData.ubfUser.idx,
        "numeUser": allData.ubfUser.numeUser,
        "codUser": allData.ubfUser.codUser,
        "nivelUser": allData.ubfUser.nivelUser,
        "activUser": allData.ubfUser.activUser,
        "adresaUser": allData.ubfUser.adresaUser,
        "telUser": allData.ubfUser.telUser,
        "emailUser": allData.ubfUser.emailUser,
        "functiaUser": allData.ubfUser.functiaUser,
        "departamUser": allData.ubfUser.departamUser,
        "obsUser": allData.ubfUser.obsUser
      };
    }
    String _js = jsonEncode(_obj);
    //print("JS ESTE...." + _js);
    String _url = Global.url + _js;
    //_url = 'https://cors-anywhere.herokuapp.com/' +_url; // daca am probleme cu CORS
    var response = await http.get(Uri.parse(_url), headers: {
      "Accept": "application/json",
      "Access-Control-Allow-Origin": "Content-Type, Authorization"
    });
//var response = await http.get(_url);
    if (response.statusCode == 200) {
      String responseBody = response.body;

//print("Raspuns de la server: "+responseBody);
      //jsonBody = json.decode(responseBody);

      completer.complete(responseBody);
    }
    return completer.future;
  }
}
